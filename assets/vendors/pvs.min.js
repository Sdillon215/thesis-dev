!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).pvs=e()}(this,(function(){"use strict";const t=new Map;function e(e,n,o){return t.set(`${e}:${n}`,o)}function n(e,n){return t.get(`${e}:${n}`)}function o(t){return t.replace(/#.*/,"")}const{on:i}=window.ivent;async function r(t,i=!0,r={}){const a=o(t);if(i){const t=n("ajax",a);if(t)return t}const c=await fetch(a,r);if(!c.ok)throw new Error("Failed to fetch page");const s=await c.text();return e("ajax",a,s),s}function a(t){return(new DOMParser).parseFromString(t,"text/html")}i(document,"ready",(()=>{e("ajax",window.location.href,document.documentElement.outerHTML)}));const c=[];function s(){c.length&&(document.querySelectorAll(".navigation-hide").forEach((t=>{t.classList.remove("navigation-hide")})),document.querySelectorAll(".social-links:not(.social-links-author)").forEach((t=>{c.forEach((e=>{if(t.querySelector(`a[href="${e.url}"]`))return;const n=document.createElement("li");n.innerHTML=`<a class="social-link" href="${e.url}" target="_blank" rel="noopener noreferrer">${e.icon}<span>${e.title}</span></a>`,t.appendChild(n)}))})))}document.addEventListener("pvs.navigation.content-rendered",(()=>{s()}));const{on:l,trigger:d}=window.ivent;function u(){return document.documentElement.getAttribute("data-color-scheme")}function g(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function m(){const t=u();return"system"===t?g():t}function f(t){document.documentElement.setAttribute("data-color-scheme",t),localStorage.setItem("color-scheme",t)}let p=!1;function h(){const t=document.querySelector('script[src*="comments-ui"]');if(!t)return;const e=m();t.setAttribute("data-color-scheme",e),p||(p="#000000"===t.getAttribute("data-accent-color")),p&&t.setAttribute("data-accent-color","dark"===e?"#525252":"#000000")}function v(t,e){document.querySelectorAll(`.nav-link-${t} > svg`).forEach((t=>{t.outerHTML=e}))}const w={selector:'a:not([target="_blank"])',target:"_blank",rel:"noopener noreferrer"};function y(t,e,n){const o=location.host.replace("www.","");document.querySelectorAll(t).forEach((t=>{t.hostname.includes(o)||(e&&t.setAttribute("target",e),n&&t.setAttribute("rel",n))}))}function b(t,e,n){var o,i=n||{},r=i.noTrailing,a=void 0!==r&&r,c=i.noLeading,s=void 0!==c&&c,l=i.debounceMode,d=void 0===l?void 0:l,u=!1,g=0;function m(){o&&clearTimeout(o)}function f(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var c=this,l=Date.now()-g;function f(){g=Date.now(),e.apply(c,i)}function p(){o=void 0}u||(s||!d||o||f(),m(),void 0===d&&l>t?s?(g=Date.now(),a||(o=setTimeout(d?p:f,t))):f():!0!==a&&(o=setTimeout(d?p:f,void 0===d?t-l:t)))}return f.cancel=function(t){var e=(t||{}).upcomingOnly,n=void 0!==e&&e;m(),u=!n},f}const S={imageSelector:".kg-gallery-image, .kg-image-card",padding:20,zIndex:1e4};function A(t,e){let n=(new Date).getTime();const o=1e3/(e||60);return function e(){requestAnimationFrame(e);const i=(new Date).getTime(),r=i-n;r>o&&(n=i-r%o,t())}()}const x={selector:".scroll-progress"};const{on:k,trigger:L}=window.ivent;function E(t){const e=t.getAttribute("href");if(!e)return t.classList.remove("loading"),void t.classList.add("complete");t.classList.add("loading");const n=t.getAttribute("data-pagination-append")||t.getAttribute("data-pagination-prepend"),o=t.getAttribute("data-pagination-from")||n,i=t.hasAttribute("data-pagination-prepend")?"prepend":"append",c=document.querySelectorAll(n),s=`[data-pagination-${i}]`;r(e).then((e=>{const r=a(e),l=r.querySelector(o),d=l.parentNode.querySelector(s)?.getAttribute("href");c.forEach((e=>{const a={href:d,page:r,toSelector:n,fromSelector:o,insertPosition:i,insertTo:e,insertFrom:l,insertCallback:!1};L(document,"pvs.pagination.render",{data:a,relatedTarget:t});const c=a.insertTo.parentNode.querySelector(s);c&&(c.classList.remove("loading"),a.href?c.setAttribute("href",a.href):(c.classList.add("complete"),c.removeAttribute("href"),"prepend"===a.insertPosition&&c.remove())),"function"==typeof a.insertCallback?a.insertCallback(a.insertTo,a.insertPosition,a.insertFrom.innerHTML):a.insertTo.insertAdjacentHTML("prepend"===a.insertPosition?"afterbegin":"beforeend",a.insertFrom.innerHTML),L(document,"pvs.pagination.rendered",{data:a,relatedTarget:t})}))})).catch((t=>{console.log(t)}))}const{on:q,trigger:T}=window.ivent;let M=!1;const $=new ResizeObserver((()=>{M&&(M.style.overflow="clip",requestAnimationFrame((()=>{M.style.overflow=""})))}));async function H(t,e,n,o){if(!(t&&Boolean(document.startViewTransition)))return o(),void window.scroll({top:n,behavior:"smooth"});const i=function(t,e){let n=document.querySelector(".pvs-navigation-view-transition-styles");if(!n){const o="linear-gradient(180deg, transparent 0, transparent 2px, #000 2.1px)",i=`linear-gradient(260deg, transparent calc(-100% + calc(200% * var(--pvs-navigation-view-transition-offset))), #000 calc(200% * var(--pvs-navigation-view-transition-offset))), ${o}`,r=`linear-gradient(260deg, #000 calc(-100% + calc(200% * var(--pvs-navigation-view-transition-offset))), transparent calc(200% * var(--pvs-navigation-view-transition-offset))), ${o}`;n=document.createElement("style"),n.classList.add("pvs-navigation-view-transition-styles"),n.textContent=`\n@media (prefers-reduced-motion) {\n\t::view-transition-group(*),\n\t::view-transition-old(*),\n\t::view-transition-new(*) {\n\t\tanimation: none !important;\n\t}\n}\n\n/* Disable root animation */\n::view-transition-image-pair(root) {\n  isolation: auto;\n}\n::view-transition-old(root),\n::view-transition-new(root) {\n  animation: none;\n  mix-blend-mode: normal;\n  display: block;\n}\n\n@property --pvs-navigation-view-transition-offset {\n\tsyntax: '<number>';\n\tinitial-value: 0;\n\tinherits: false;\n}\n\n@keyframes pvs-navigation-view-transition {\n\t0% {\n\t\t--pvs-navigation-view-transition-offset: 0;\n\t}\n\t100% {\n\t\t--pvs-navigation-view-transition-offset: 1;\n\t}\n}\n\n${e} {\n\tview-transition-name: content;\n}\n\n::view-transition-old(content),\n::view-transition-new(content) {\n\tanimation-name: pvs-navigation-view-transition;\n\tanimation-duration: ${t}s;\n\tanimation-delay: 0s;\n\tanimation-timing-function: cubic-bezier(0.32, 0, 0.45, 1);\n\tanimation-fill-mode: both;\n\n\tmask-composite: source-in;\n\t-webkit-mask-composite: source-in;\n}\n\n::view-transition-old(content) {\n\tmask-image: ${i};\n\t-webkit-mask-image: ${i};\n}\n\n::view-transition-new(content) {\n\tmask-image: ${r};\n\t-webkit-mask-image: ${r};\n}`,document.head.appendChild(n)}return n}(t,e);M=document.querySelector(e);const r=document.startViewTransition((()=>{o(),window.scroll({top:n,behavior:"instant"}),$.observe(M)}));await r.finished,$.unobserve(M),M=!1,i.remove()}let P="",D=0,I=null;function z(){return I||(I=document.createElement("div"),I.classList.add("page-loader"),document.body.appendChild(I)),I}function C(){P="start",D=0}function N(){P="end"}A((function(){!P||"end"===P&&D>=100||("end"!==P&&D>=99&&(D=99),D+="end"===P?6:D>80?.03:D>70?.05:D>60?.08:D>40?.1:D>30?.3:D>20?.5:1,z().style.setProperty("--loader-progress",`${Math.min(100,D).toFixed(2)}%`),"start"===P&&(P="in-progress",z().classList.add("loading")),D>99&&(z().classList.remove("loading"),D=100))}),60);var F=Object.freeze({__proto__:null,finish:N,start:C});const{on:j,trigger:O}=window.ivent,_={linksSelector:'a:not(.no-ajax, [target="_blank"], [href^="#"], [href^="mailto"], [href^="javascript:"], [href*="#/portal"])',contentSelector:"main.content",transitionDuration:.4};function W(){return location.origin+location.pathname+location.search}function B(t){const e=document.createElement("script");Array.from(t.attributes).forEach((t=>e.setAttribute(t.name,t.value))),t.replaceWith(e)}const{on:K}=window.ivent,Y={selector:".dropdown",toggleSelector:".dropdown-toggle"};var R={version:"1.0.1",ajax:r,parseHTML:a,addSocialLink:function(t,e,n){let o=!1;c.forEach((e=>{o=o||e.url===t})),o||(c.push({url:t,title:e,icon:n}),s())},getSocialLinks:function(){return c},renderSocialLinks:s,addNavIcon:v,addExternalLinkAttributes:function(t={}){const e={...w,...t},{on:n}=window.ivent;y(e.selector,e.target,e.rel),n(document,"pvs.navigation.content-rendered",(()=>{y(e.selector,e.target,e.rel)}))},pageLoader:F,initDarkMode:function(){l(document,"click",".toggle-color-scheme-button",(t=>{t.preventDefault();const e=t.delegateTarget.getAttribute("value"),n=u(),o=m();if(n!==e){if(document.documentElement.classList.add("stop-transition"),/(?=.*dark)(?=.*light)(?=.*system)/g.test(e)){const t="dark"===g()?["dark","system","light"]:["light","system","dark"];f(t[t.indexOf(n)+1]||t[0])}else/(?=.*dark)(?=.*light)/g.test(e)?f("dark"===o?"light":"dark"):f(e);d(document,"pvs.dark-mode.toggle"),document.documentElement.offsetHeight,document.documentElement.classList.remove("stop-transition")}})),h(),l(window,"load",(()=>{h()})),l(document,"pvs.dark-mode.toggle pvs.navigation.content-rendered",(()=>{h()}))},getSelectedColorScheme:u,getSystemColorScheme:g,getActualColorScheme:m,updateColorScheme:f,initLightbox:function(t={}){const{on:e}=window.ivent,n={...S,...t},{getComputedStyle:o}=window,{body:i}=document;let r,a;const c=new Map;let s,l,d=!1;function u(){const t=window.innerWidth-i.offsetWidth||parseFloat(o(i).paddingRight);r=window.innerWidth-t,a=window.innerHeight}function g(t){if(!t.querySelector(".lightbox-trigger")){d=!0;const e=t.querySelector("img"),n=t.closest(".kg-card").querySelector("figcaption"),o=e.getAttribute("alt")||n?.textContent||"Open lightbox",i=document.createElement("button");i.classList.add("lightbox-trigger"),i.setAttribute("type","button"),i.setAttribute("aria-label",o),t.append(i),t.classList.add("lightbox")}}function m(t){const e=c.get(t),{image:o,naturalWidth:i,naturalHeight:s,posX:l=0,posY:d=0}=e,{width:u,height:g,top:m,left:f}=t.getBoundingClientRect(),p=(r-u)/2-f+l,h=(a-g)/2-m+d;e.posX=p,e.posY=h,t.style.setProperty("transform",`translate(${p}px, ${h}px)`),o.style.setProperty("transform",`scale(${function(t,e,o,i){const c=(r-2*n.padding)/t,s=(a-2*n.padding)/e,l=Math.min(c,s);return l*e>i||l*t>o?Math.min(i/e,o/t):Math.min(l,s)}(u,g,i,s)})`)}function f(t){const e=c.get(t),{image:o,zIndex:i,trigger:r}=e;r.focus(),o.style.transform="",t.style.transform="",t.style.zIndex=i-1,s.style.zIndex=i-1,t.classList.remove("lightbox-show"),t.classList.add("lightbox-hiding"),e.hasHide=!0,e.posX=0,e.posY=0,e.hideTimeout=setTimeout((()=>{t.style.zIndex="",t.classList.remove("lightbox-hiding"),e.hasHide=!0,e.zIndex=n.zIndex}),500),s.classList.remove("lightbox-overlay-show")}function p(t){const e=c.get(t);if(s||(s=document.createElement("div"),s.classList.add("lightbox-overlay"),l=document.createElement("button"),l.classList.add("lightbox-close"),l.setAttribute("type","button"),l.setAttribute("aria-label","Close"),document.querySelector(".post-content").before(s,l)),e&&!e.hasHide)f(t);else{if(!e){const e=t.querySelector("img");g(t),c.set(t,{image:e,naturalWidth:parseFloat(e.getAttribute("width")),naturalHeight:parseFloat(e.getAttribute("height")),trigger:t.querySelector(".lightbox-trigger")})}!function(t){const e=c.get(t),{image:o}=e;o.complete||o.addEventListener("load",(()=>{m(t)})),clearTimeout(e.hideTimeout),l.focus(),t.classList.add("lightbox-show"),t.classList.remove("lightbox-hiding"),t.style.setProperty("z-index",n.zIndex),m(t),e.zIndex=n.zIndex,e.hasHide=!1,s.style.setProperty("z-index",n.zIndex),s.classList.add("lightbox-overlay-show")}(t)}}u(),document.querySelectorAll(n.imageSelector).forEach(g),e(document,"click",n.imageSelector,(t=>{t.target.classList.contains("lightbox-trigger")||p(t.delegateTarget)})),e(document,"click",".lightbox-trigger",(t=>{t.preventDefault();p(t.delegateTarget.closest(n.imageSelector))})),e(document,"click",".lightbox-overlay, .lightbox-close",(t=>{t.preventDefault(),c.forEach(((t,e)=>{t.hasHide||f(e)}))})),e(document,"keydown",(t=>{"Escape"===t.key?c.forEach(((t,e)=>{t.hasHide||f(e)})):"Tab"===t.key&&c.forEach((e=>{e.hasHide||(t.preventDefault(),l.focus())}))})),e(window,"scroll",b(200,(()=>{c.forEach(((t,e)=>{t.hasHide||f(e)}))}))),e(window,"resize",function(t,e,n){var o=(n||{}).atBegin;return b(t,e,{debounceMode:!1!==(void 0!==o&&o)})}(100,(()=>{d&&(u(),c.forEach(((t,e)=>{t.hasHide||m(e)})))}))),e(window,"load",u),e(document,"pvs.navigation.content-rendered",(()=>{document.querySelectorAll(n.imageSelector).forEach(g),s=document.querySelector(".lightbox-overlay")}))},initScrollProgress:function(t){const e={...x,...t},{selector:n}=e,o=document.querySelectorAll(n);if(!o)return;let i=null;A((function(){const t=function(){const t=window.scrollY,e=document.documentElement.scrollHeight-document.documentElement.clientHeight;return Math.max(0,Math.min(100,t/e*100))}(),e=function(t,e,n){return(1-n)*t+n*e}(null===i?t:i,t,.25);e!==i&&(i=e,o.forEach((t=>{t.style.setProperty("--scroll-progress",`${function(t,e=1){const n=10**e;return Math.round(t*n)/n}(i,2)}%`)})))}),60)},initNavigation:function(t={}){const i={..._,...t},{linksSelector:c,contentSelector:s,transitionDuration:l}=i;let d=!1,u=W();function g(t,i=0){O(document,"pvs.navigation.loading"),function(t){e("page-scroll",t,document.documentElement.scrollTop||document.body.scrollTop)}(u);const c=!n("ajax",o(t));c&&C(),r(t).then((e=>{!function(t,e,n=0){u=t;const o=a(e),i=o.title,r=Array.from(o.head.querySelectorAll("meta[content]")),c=o.querySelector(s),g=o.body.getAttribute("class"),m=document.querySelector(s);"undefined"!=typeof history&&d&&history.pushState({page:t},i,t);const f={href:t,page:o};O(document,"pvs.navigation.content-render",{data:f}),document.title=i,H(l,s,n,(()=>{document.body.setAttribute("class",g),m.innerHTML=c.innerHTML,document.body.style.overflow="",document.querySelectorAll(".nav-link").forEach((e=>{e.href===t?e.classList.add("nav-link-current"):e.classList.remove("nav-link-current")}));const e=m.querySelectorAll("script");if(e&&e.forEach((t=>{B(t)})),m.querySelector("[data-ghost-search]")){document.querySelectorAll("#sodo-search-root").forEach((t=>t.remove()));const t=document.querySelector('script[src*="sodo-search"]');t&&B(t)}const n=document.querySelector('script[src*="cards"]');n&&B(n),document.head.querySelectorAll("meta[content]").forEach((t=>{t.remove()})),r.forEach((t=>{document.head.appendChild(t)})),O(document,"pvs.navigation.content-rendered",{data:f})}))}(t,e,i),c&&N(),O(document,"pvs.navigation.loaded")})).catch((()=>{window.location=t}))}j(document,"click",c,(t=>{const e=t.delegateTarget,{href:n}=e;t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||window.location.protocol===e.protocol&&window.location.hostname===e.hostname&&"file:"!==window.location.protocol&&(t.defaultPrevented||(t.preventDefault(),u!==n&&(d=!0,g(n))))})),j(window,"popstate",(()=>{const t=W();u!==t&&(d=!1,g(t,n("page-scroll",t)||0))}))},initPagination:function(){k(document,"click","[data-pagination][href]",(t=>{t.preventDefault();const e=t.delegateTarget;e.classList.contains("loading")||(E(e),"load-more-infinite"===e.getAttribute("data-pagination")&&e.setAttribute("data-pagination","infinite"))}));const t=new IntersectionObserver(((t,e)=>{try{t.forEach((t=>{t.isIntersecting&&t.target&&!t.target.classList.contains("loading")&&(t.target.getAttribute("href")?E(t.target):e.disconnect())}))}catch(t){console.log(t)}}),{scrollMargin:"10px"}),e=b(200,(()=>{document.querySelectorAll('[data-pagination="infinite"][href]:not(.pvs-pagination-infinite-handled)').forEach((e=>{e.classList.add("pvs-pagination-infinite-handled"),t.observe(e)}))}));new MutationObserver(e).observe(document.documentElement,{childList:!0,subtree:!0})},initFilter:function(){const t=new Map;function e(t){const e=t.parentNode;return{paginationNext:e.querySelector("[data-pagination-append]"),paginationPrev:e.querySelector("[data-pagination-prepend]")}}function n(t,n){const{paginationNext:o,paginationPrev:i}=e(n);t.newList=n.cloneNode(!0),t.dataNext=Boolean(o)&&{href:o.getAttribute("href"),from:o.getAttribute("data-pagination-from")||o.getAttribute("data-pagination-append")},t.dataPrev=Boolean(i)&&{href:i.getAttribute("href"),from:i.getAttribute("data-pagination-from")||i.getAttribute("data-pagination-append")}}function o(t,e){t&&e?(e.href?(t.classList.remove("complete"),t.setAttribute("href",e.href),e.from&&t.setAttribute("data-pagination-from",e.from)):t.removeAttribute("href"),t.style.display=""):t&&!e&&(t.style.display="none")}function i(t,n){const{newList:i,dataNext:r,dataPrev:a}=n;t.forEach((t=>{t.innerHTML=i.innerHTML,t.classList.remove("loading");const{paginationNext:n,paginationPrev:c}=e(t);o(n,r),o(c,a)})),T(document,"pvs.filter.rendered")}q(document,"focus","[data-filter]",(e=>{const o=e.delegateTarget,{value:i}=o;if(t.has(o))return;t.set(o,{});const r=t.get(o);if(!r[i]){r[i]={};const t=o.getAttribute("data-filter-append");n(r[i],document.querySelector(t))}})),q(document,"change","[data-filter]",(e=>{const o=e.delegateTarget,{value:c}=o,s=o.getAttribute("data-filter-append"),l=o.getAttribute("data-filter-from")||s,d=document.querySelectorAll(s);t.has(o)||t.set(o,{}),document.querySelectorAll("[data-filter]").forEach((t=>{t.getAttribute("data-filter-append")===s&&(t.value=c)}));const u=t.get(o);u[c]?i(d,u[c]):(d.forEach((t=>t.classList.add("loading"))),async function(t,e){try{return a(await r(t)).querySelector(e)}catch(t){throw new Error(t)}}(c,l).then((t=>{u[c]={},n(u[c],t),i(d,u[c])})))})),q(document,"pvs.pagination.rendered",(()=>{t.forEach(((t,e)=>{const o=e.getAttribute("data-filter-append");n(t[e.value],document.querySelector(o))}))}))},initDropdown:function(t){const e={...Y,...t};let n=null,o=null;function i(t){n||(o=t,o.setAttribute("aria-expanded","true"),n=t.parentNode.querySelector(e.selector),n.classList.add("show"))}function r(t=!1){n&&(n.classList.remove("show"),o.setAttribute("aria-expanded","false"),t&&o.focus(),o=null,n=null)}function a(){document.querySelectorAll(e.selector).forEach((t=>{t.classList.contains("dropdown-ready")||(t.classList.add("dropdown-ready"),"1"!==window.getComputedStyle(t).opacity||t.classList.contains("show")||i(t.parentNode.querySelector(e.toggleSelector)))}))}a(),K(document,"pvs.navigation.content-rendered pvs.pagination.rendered",a),K(document,"click",e.toggleSelector,(t=>{if(t.preventDefault(),n)return void r();const e=t.delegateTarget;e.focus(),i(e)})),K(document,"keyup",(t=>{"Escape"===t.key&&r(!0)})),K(document,"click",`${e.selector} a, ${e.selector} button`,(()=>{r(!0)})),K(document,"blur",`${e.selector} a, ${e.selector} button, ${e.toggleSelector}`,(t=>{const i=t.relatedTarget;n&&i!==o&&(i?.closest(e.selector)&&i||r(!i))}))},addMenuIcon:(...t)=>(console.log("addMenuIcon is deprecated. Use addNavIcon instead."),v(...t))};return R}));
